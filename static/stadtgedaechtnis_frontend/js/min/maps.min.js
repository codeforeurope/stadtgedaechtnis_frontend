function errorLocationCallback(e){userLocation.moveToLocation(this.DEFAULT_LAT,this.DEFAULT_LONG),alert("There was an error obtaining your position. Message: "+e.message)}function addMarker(e){var t=parseFloat(e.latitude),i=parseFloat(e.longitude),o=e.stories.length;if(o>9&&(o=0),!userLocation.markers.hasOwnProperty(e.id)){var n=new google.maps.Marker({map:userLocation.map,position:new google.maps.LatLng(t,i),title:e.title,icon:"/static/stadtgedaechtnis_frontend/img/marker_"+o+".png",animation:google.maps.Animation.DROP});e.marker=n,createInfobox(e),userLocation.markers[e.id]=e}}function createInfobox(e){if(e.stories.length>1){for(var t="<div class='infowindow'><ul>",i=0;i<e.stories.length;i++)t+="<li><a href='#' class='switch-entry' data-entry='"+i+"'>"+e.stories[i].title+"</a></li>";t+="</ul></div>"}else var t="<div class='infowindow'><p>"+e.stories[0].abstract+"</p></div>";var o=new google.maps.InfoWindow({content:t,maxWidth:225});e.infobox=o,google.maps.event.clearListeners(e.marker,"click"),google.maps.event.addListener(e.marker,"click",function(){openEntry(e)}),google.maps.event.addListener(o,"closeclick",closeEntry)}function loadAdditionalEntry(e){if(!e.data("loaded")){var t=e.data("entry"),i=e.data("id");$("article#entry-more-"+t).html(""),$("img#load-more-"+t).show(),$.get("/entry/"+i+"/",function(i){$("article#entry-more-"+t).html(i),$("img#load-more-"+t).hide(),e.data("loaded",!0)})}}function openEntry(e){for(var t="",i=0;i<e.stories.length;i++)t+='<li data-entry="'+i+'" data-id="'+e.stories[i].id+'">                        <div class="article-heading">                            <div class="article-heading-row">',i>0&&(t+='    <a href="#" class="previous"><div class="article-heading-cell entry-slide previous">                <img src="/static/stadtgedaechtnis_frontend/img/left.png">            </div></a>'),t+='<div class="article-heading-cell">                                    <h3 id="article-heading-'+i+'">'+e.stories[i].title+"</h3>                                </div>",i<e.stories.length-1&&(t+='<a href="#" class="next"><div class="article-heading-cell entry-slide next">                <img src="/static/stadtgedaechtnis_frontend/img/right.png">            </div></a>'),t+="</div>                        </div>",void 0!==e.stories[i].assets[0]&&(t+='<img src="'+e.stories[i].assets[0].sources+'" alt="'+e.stories[i].assets[0].alt+'" id="entry-first-'+i+'"/>'),t+='<div class="center">                            <img src="/static/stadtgedaechtnis_frontend/img/ajax-loader.gif" id="load-more-'+i+'" class="load-more">                        </div>                        <article class="entry-more" id="entry-more-'+i+'">                        </article>                    </li>';$("div.entry-list ul").html(t);var o=$("section#article-section div.entry-list");if(e.stories.length>1?($("div.entry-slide").show(),$("div.article-heading-row a.previous").unbind("click").click(function(){return o.data("unslider").prev(),!1}),$("div.article-heading-row a.next").unbind("click").click(function(){return o.data("unslider").next(),!1})):$("div.entry-slide").hide(),null===userLocation.currentInfobox){var n=$("section#article-section");if($(window).width()<768)channel="mobile",n.css("padding","0.8rem 0.8rem 0 0.8rem"),o.data("unslider")&&o.data("unslider").set(0,!0),n.transition({height:footerHeight},200,"ease"),initializeFooterSwiping(),$("main").transition({paddingBottom:footerHeight,marginBottom:"-"+footerHeight},200,"ease",function(){o.unslider({complete:loadAdditionalEntry}),o.data("unslider").set(0,!0)});else{$("div.article-heading").swipe("disable"),channel="desktop",n.css({height:"100%",width:"0%",padding:"0.8rem"});var a=$("section.max_map"),r=a.width();o.data("unslider")&&o.data("unslider").set(0,!0),a.transition({width:r-380+"px"},200,"ease"),n.transition({width:"380px"},200,"ease",function(){o.unslider({complete:loadAdditionalEntry}),o.data("unslider").set(0,!0)}),$("div.entry-list ul li").css("overflow-y","auto")}}else o.data("unslider").set(0,!0),userLocation.currentInfobox.close(),o.unslider({complete:loadAdditionalEntry}),"desktop"===channel?$("div.entry-list ul li").css("overflow-y","auto"):initializeSwiping();loadAdditionalEntry($("div.entry-list ul li:first")),userLocation.currentInfobox=e.infobox,e.infobox.open(userLocation.map,e.marker),e.stories.length>1&&$("a.switch-entry").each(function(){$(this).click(function(e){var t=$(this).data("entry");return o.data("unslider").move(t),e.preventDefault,!1})})}function closeEntry(){var e=$("section#article-section");"mobile"===channel?(e.transition({height:0},200,"ease"),$("main").transition({paddingBottom:"0px",marginBottom:"0px"},200,"ease",function(){e.css("padding","0rem"),$("div.entry-list ul").removeAttr("style")})):(e.transition({width:"0%"},200,"ease",function(){e.css({height:"100%",padding:"0rem",width:"auto"}),$("div.entry-list ul").removeAttr("style")}),$("section.max_map").transition({width:"100%"},200,"ease")),null!==userLocation.currentInfobox&&(userLocation.currentInfobox.close(),userLocation.currentInfobox=null)}function searchForEntries(){var e=userLocation.map.getBounds(),t=e.getNorthEast().lat().toFixed(10),i=e.getNorthEast().lng().toFixed(10),o=e.getSouthWest().lat().toFixed(10),n=e.getSouthWest().lng().toFixed(10);$.getJSON("/services/locations/"+o+"/"+t+"/"+n+"/"+i+"/stories/title/image/",function(e){$.each(e,function(e,t){addMarker(t)})})}function Location(){this.DEFAULT_LAT=50.258,this.DEFAULT_LONG=10.965,this.DEFAULT_LOCATION=new google.maps.LatLng(50.258,10.965),this.positionMarker=null,this.markers={},this.currentInfobox=null}function initialize_Map(){userLocation.map=new google.maps.Map(document.getElementById(MAP_ELEMENT),mapOptions),userLocation.positionMarker=new GeolocationMarker(userLocation.map),userLocation.moveToCurrentLocationOrFallback(),google.maps.event.addListener(userLocation.positionMarker,"geolocation_error",errorLocationCallback),google.maps.event.addListener(userLocation.map,"idle",searchForEntries),google.maps.event.addListener(userLocation.map,"click",closeEntry)}var MAP_ELEMENT="map_canvas",channel="mobile";Location.prototype.moveToCurrentLocationOrFallback=function(){Modernizr.geolocation?google.maps.event.addListenerOnce(this.positionMarker,"position_changed",function(){this.map.setCenter(this.getPosition()),this.map.fitBounds(this.getBounds()),searchForEntries()}):this.moveToLocation(this.DEFAULT_LAT,this.DEFAULT_LONG)},Location.prototype.moveToLocation=function(e){this.map&&(this.map.panTo(e),searchForEntries())};var userLocation=new Location,mapOptions={center:userLocation.DEFAULT_LOCATION,zoom:17,mapTypeControl:!0,mapTypeId:google.maps.MapTypeId.SATELLITE,disableDefaultUI:!0,zoomControl:!0};